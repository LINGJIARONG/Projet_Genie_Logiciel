<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <title>Reservation</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
     <link
	href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.css">
<link href="css/search.css" rel="stylesheet">
<link href="css/general.css" rel="stylesheet">
<link href="css/reservation.css" rel="stylesheet">

<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script
	src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>

<script type="text/javascript"
	src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script type="text/javascript"
	src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.js"></script>
   </head>
   <body>
         <a id="back" href="#"> back </a>
   
      <div class="container">
         <div id="div1" class="row col-md-5 col-md-offset-2 custyle">
         </div>
      </div>
      
<!-- The Modal -->
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <div class="modal-header">
      <span class="close">&times;</span>
      <p><b>Verification</b></p>
    </div>
    <div class="modal-body">
     <p ><b id='vec'>Accepting this reservations?</b></p>
     <p id='name'></p>
     <p id='seat_wanted'>1</p>
	 <p id='seat_left'>1</p>
     <p id='date'>1</p>
     <p id='departure'>1</p>
     <p id= 'arrival'> 1</p>
     <a id= 'more' href="#" target="_blank"> </a>
     
      
    </div>
    <div class="modal-footer">
    <input id="accept" onclick="approve()" type="button" value="accept">
    <input id="back" onclick="back()" type="button" value="cancel">
    </div>
  </div>

	</div>
 </body>
   
      <script type="text/javascript">
         $.ajax({
         type: "get",
         url: '/ws/reservation/myreservations/'+sessionStorage.getItem("user"),
         success: function(data) {
         //alert(data);
         	var tbl="<table id=\"itable\" class=\"table table-striped custab\">\r\n" + 
         "               <thead>\r\n" + 
         "                  <tr>\r\n" + 
         "                     <th>ID</th>\r\n" + 
         "                     <th>Flight</th>\r\n" + 
         "                     <th>Seat Booked</th>\r\n" + 
         "                     <th>State</th>\r\n" + 
         "                     <th class=\"text-center\">Action</th>\r\n" + 
         "                  </tr>\r\n" + 
         "               </thead>"
         
         for(var i=0;i<data.length;i++)
         {
             var obj = JSON.parse(data[i]);
             var td0="<tr><td>"+obj.id+"</td>";
             var td1="<td>"+obj.flightId+"</td>";
             var td3="<td>"+obj.seat+"</td>";
          
             var td3_5="<td>"+(obj.approved=="true"?"approved":"waiting")+"</td>";
             var td4="<td class=\"text-center\"><a  onclick=\"show(\'"+obj.id+"\');\"  	class='btn btn-info btn-xs' ><span class=\"glyphicon glyphicon-ok\" ></span> View</a>"

         tbl+=td0+td1+td3+td3_5+td4; 
           
         }
        	tbl += "</table>";
    			document.getElementById("div1").innerHTML = "";
    			$("#div1").append(tbl);
    			$("#itable").DataTable();

         }
         });

       	$(document).ready(function(){
       		var type=sessionStorage.getItem("type");
       		if(type=="Passenger"){
       			$('#back').attr("href","test.html");
       		}else{
       			$('#back').attr("href",'testp.html');
       		}
       	});
       	
       	
       	
     // Get the modal
        var modal = document.getElementById('myModal');


        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        function back(){
      	  modal.style.display = "none";
      	  document.location.reload(true);
        }
       
        
        function cancel(id){
      	  console.log("disapprove"+id);
      	  var result=id;
      	  $.ajax({
      		  type:"delete",
      		  url:"/ws/reservation/disapprove/"+id,
      		  success: function (data) {
    			  	console.log("success : "+data);
      				console.log(data.result);
        		  	$('#name').html("");	
        		  	$('#seat_wanted').html("");	
        		  	$('#vec').html("success, the reservation has been disapproved/canceled!");	
      		  		$('#seat_left').html("");
    	    	    $('#date').html("");
    	    	    $('#arrival').html("");
    	    	    $('#departure').html("");
    	    	    $('#accept').attr("onclick",'back();');
   	    	    $('#accept').attr("value",'Ok');

    		  },
    		  error:function(error){
  	    		alert(error);
    		  },   		  
    		});	 	    
      }
        // When the user clicks the button, open the modal 
       function show(id) {
      	 $.get( "/ws/reservation/getbyid/"+id, function( data ) {
  			var seat=data.seat;
  			var flightId=data.flightId;
      	     $('#seat_wanted').html("Seats booked : "+seat);
        	 $('#vec').html("Information flight");
        	 sessionStorage.setItem("flight_info",flightId);
 			$('#more').attr("href","flight_detail.html");
 			$('#more').html("more information");
      	     $.get( "/ws/flight/getbyid/"+flightId, function( data2 ) {
      				var seat=data2.seat;
      				var date=data2.date;
      				var arrival=data2.arrival;
      				var departure=data2.departure;
  	     			var pil=data2.pilotId;
      	    	     $('#seat_left').html("Seats left :" +seat);
      	    	     $('#date').html("date : "+date);
      	    	     $('#arrival').html("arrival : "+arrival);
      	    	     $('#departure').html("departure : "+departure);
      	    	  	 $.get( "/ws/user/profile/"+pil, function( data3 ) {
      	   				var fn=data3.firstName;
      	   				var ln=data3.lastName;
      	   	    	     $('#name').html("Pilot : "+fn+" "+ ln);
      	   	    		});
      	      		});
      	    		});
      	    
          modal.style.display = "block";
          $('#accept').attr("onclick",'back();');
          $('#accept').attr("value",'OK');

        }
        
       function show2(id) {
      	 show(id);
      	 $('#vec').html("Deleting this reservation?");
           modal.style.display = "block";
           $('#accept').attr("onclick","cancel(''"+id+"'');");
           $('#accept').attr("value",'Delete');

         }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
          modal.style.display = "none";
        }

      </script>
</html>