<!doctype html>
<html>

<head>
<meta charset="utf-8">
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />

<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<link rel="stylesheet" href="css/Edit_Flight.css" />
<title>Edit flight</title>
</head>
<script>
$(function(){
var log=sessionStorage.getItem("user");
if(log!=null){
	$('#login').hide();
}
console.log(log);
});
</script>
    <body>
       <header>
    		<nav class="navbar navbar-light" style="background-color: #FFA500;">
  				<a class="navbar-brand" href="index.html">Kechache Airport</a>
  				<p id='login'><a href="login.html">Log In</a>/<a href="registration.html">Sign Up</a></p>
  				<form class="form-inline">
    				<input class="form-control mr-sm-2" type="search" placeholder="Ville de dÃ©part..." aria-label="Search"
    				onclick="location.replace('search.html')">
    				<button class="btn btn-warning" type="submit">Search</button>
  				</form>
			</nav>
		</header>
	<section>
		<form>
			<div class="form-row">
				<div class="form-group col-md-6">
					<label for="departure">Departure</label> <input type="text"
						class="form-control" id="departure" placeholder="Paris">
				</div>
				<div class="form-group col-md-6">
					<label for="arrival">Arrival</label> <input type="text"
						class="form-control" id="arrival" placeholder="Bordeaux">
				</div>
			</div>
			<div class="form-row">
				<div class="form-group col-md-4">
					<label for="price">Price</label> <input type="number"
						class="form-control" id="price" placeholder="60">
				</div>
				<div class="valid-feedback">Looks good!</div>
				<div class="form-group col-md-4">
					<label for="places">Available places</label> <input type="number"
						class="form-control" id="places" placeholder="350">
				</div>
				<div class="form-group col-md-4">
					<label for="duration">Flight duration</label> <input type="time"
						class="form-control" id="duration" placeholder="1:30">
				</div>
			</div>
			<label for="description">Description</label><br />
			<textarea name="description" id="description" rows="10" cols="60"
				placeholder="say hi to your passenger"></textarea>
			<div class="form-group">
				<div class="form-check">
					<input class="form-check-input is-invalid" type="checkbox" value=""
						id="invalidCheck" required> <label
						class="form-check-label" for="invalidCheck"> Agree to
						terms and conditions </label>
					<div class="invalid-feedback">You must agree before
						submitting.</div>
				</div>
			</div>
			<button class="btn btn-wanted" id="submitf" type="button"
				onclick="modify();">Edit form</button>
			<button class="btn btn-danger" id="cancel" onclick="reset();">Reset</button>
		</form>
	</section>
</body>
<script>
$(document).ready(function() {
	var id=sessionStorage.getItem('flight_info');
	var user=sessionStorage.getItem("user");
	sessionStorage.setItem("userId",user);
	$.ajax({
		type: "get",
		url: '/ws/flight/getbyid/'+id,
		success: function(data) {
			 $('#places').attr("placeholder",data.seat);
    		 $('#departure').attr("placeholder",data.departure);
    		 $('#arrival').attr("placeholder",data.arrival);
    		 $('#duration').attr("placeholder",data.duration);
    		 $('#price').attr("placeholder",data.price);
    		$('#description').attr("placeholder",data.description);
		},
		error: function(){
			alert("can't find coresponding flights");
		}
	}) 
});

function reset(){
	var id=sessionStorage.getItem('flight_info');
	var user=sessionStorage.getItem("user");
	sessionStorage.setItem("userId",user);
	$.ajax({
		type: "get",
		url: '/ws/flight/getbyid/'+id,
		success: function(data) {
			$('#places').attr("placeholder",data.seat);
    		$('#departure').attr("placeholder",data.departure);
    		$('#arrival').attr("placeholder",data.arrival);
    		$('#duration').attr("placeholder",data.duration);
    		$('#price').attr("placeholder",data.price);
    		$('#description').attr("placeholder",data.description);
		},
		error: function(){
			alert("can't find coresponding flights");
		}
	})
}



	function modify() {
		var flight_id = sessionStorage.getItem('flight_info');
		var user_id = sessionStorage.getItem("user");
		var f_seat;
		var f_passengerId;
		var f_departure;
		var f_arrival;
		var f_date;
		var f_time;
		var f_duration;
		var f_price;
		var f_info;
		$.ajax({
			type: "get",
			url: '/ws/flight/getbyid/'+flight_id,
			success: function(data) {
				f_seat=data.seat;
	    		f_passengerId=data.passengerId;
	    		f_arrival=data.arrival;
	    		f_departure=data.departure;
	    		f_duration=data.duration;
	    		f_price=data.price;
	    		f_description=data.description;
	    		f_date=data.date;
	    		f_info=data.info;
	    		f_time=data.time;
	    		console.log(data.info+f_seat);
	    		if($('#places').val()!='')
	    			f_seat=$('#places').val();
	    	

	    		if($('#departure').val()!='')
	    			f_departure=$('#departure').val();
	    		if($('#arrival').val()!='')
	    			f_arrival=$('#arrival').val();
	    		if($('#duration').val()!='')
	    			f_duration=$('#duration').val();
	    		if($('#price').val()!='')
	    			f_price=$('#price').val();
	    		if($('#description').val()!='')
	    			f_info=$('#description').val();
	    		var newFlight = {
	    			id : flight_id,
	    			pilotId : user_id,
	    			seat : f_seat,
	    			passengerId : f_passengerId,
	    			departure : f_departure,
	    			arrival : f_arrival,
	    			date : f_date,
	    			time : f_time,
	    			duration : f_duration,
	    			price : f_price,
	    			info : f_info
	    		}
	    		$.ajax({
	    			url : "/ws/flight/add",
	    			type : 'put',
	    			dataType : 'json',
	    			contentType : 'application/json',
	    			data : JSON.stringify(newFlight),

	    			success : function(data) {
	    				console.log(newFlight);
	    				alert("successful!");
	    				//location.replace("testp.html");
	    			}

	    		})
			},
			error: function(){
				alert("can't find coresponding flights");
			}
		})
		
	}
</script>
</html>


